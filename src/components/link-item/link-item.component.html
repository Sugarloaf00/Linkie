
<div class="bg-surface rounded-lg shadow-lg p-5 transition-transform hover:scale-[1.02] duration-300 flex space-x-4">
  <!-- Voting Section -->
  <div class="flex flex-col items-center space-y-2 pt-1">
    <button (click)="upvote()" [class.text-green-400]="userVote() === 'up'" [class.text-gray-400]="userVote() !== 'up'" class="hover:text-green-400 transition-colors">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />
      </svg>
    </button>
    <span class="font-bold text-lg text-text-primary">{{ voteCount() }}</span>
    <button (click)="downvote()" [class.text-red-400]="userVote() === 'down'" [class.text-gray-400]="userVote() !== 'down'" class="hover:text-red-400 transition-colors">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
      </svg>
    </button>
  </div>

  <!-- Content Section -->
  <div class="flex-1">
    <a [href]="link().url" target="_blank" rel="noopener noreferrer" class="hover:underline">
      <h3 class="text-xl font-semibold text-text-primary mb-1">{{ link().title }}</h3>
    </a>
    <p class="text-text-secondary text-sm mb-2">{{ link().description }}</p>
    <a [href]="link().url" target="_blank" rel="noopener noreferrer" class="text-primary text-xs break-all hover:text-primary-hover">
      {{ link().url }}
    </a>
    <div class="text-xs text-gray-500 mt-3 flex items-center space-x-2">
      @if (link().submittedBy.avatarUrl) {
        <img [src]="link().submittedBy.avatarUrl" [alt]="link().submittedBy.name" class="h-5 w-5 rounded-full" />
      }
      <span>
        Submitted by <span class="font-semibold text-gray-400">{{ link().submittedBy.name }}</span> on {{ link().createdAt | date:'short' }}
      </span>
    </div>

    <!-- Comments Toggle -->
    <div class="mt-4">
      <button (click)="toggleComments()" class="text-sm text-gray-400 hover:text-white flex items-center space-x-1">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
        </svg>
        <span>{{ link().comments.length }} Comments</span>
      </button>
    </div>

    @if (showComments()) {
      <div class="mt-4 space-y-4">
        <!-- Add Comment Form -->
        <div class="flex space-x-2">
          <input 
            type="text" 
            placeholder="Add a comment..." 
            [value]="newCommentText()"
            (input)="newCommentText.set($any($event.target).value)"
            (keyup.enter)="addComment()"
            class="flex-grow bg-background border border-gray-600 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-primary focus:outline-none" 
          />
          <button (click)="addComment()" class="bg-primary text-white font-semibold px-4 py-2 rounded-md text-sm hover:bg-primary-hover">Post</button>
        </div>
        <!-- Comments List -->
        <div class="space-y-4 max-h-60 overflow-y-auto pr-2">
          @for (comment of link().comments; track comment.id) {
            <div class="flex items-start space-x-2">
              @if (comment.user.avatarUrl) {
                <img [src]="comment.user.avatarUrl" [alt]="comment.user.name" class="h-8 w-8 rounded-full flex-shrink-0" />
              }
              <div class="flex-1 text-sm bg-background p-3 rounded-md">
                <div class="flex items-baseline justify-between">
                    <span class="font-semibold text-gray-400">{{ comment.user.name }}</span>
                    <span class="text-xs text-gray-500">{{ comment.timestamp | date:'shortTime' }}</span>
                </div>
                <p class="text-text-primary mt-1">{{ comment.text }}</p>
              </div>
            </div>
          } @empty {
            <p class="text-xs text-gray-500 italic">No comments yet.</p>
          }
        </div>
      </div>
    }
  </div>
</div>